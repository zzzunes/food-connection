<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <meta charset="utf-8">
    <title>User Data</title>

</head>
<h1> Enter the New Food: </h1>
<body>
Demography: <br><br>

    <label> All Users<input type="checkbox" name="allUsers" id="nuts"></label><br><br>
    Race:
    <div>
        <label>black<input type="checkbox" name="black" value= "" id="black"></label>
        <label>white<input type="checkbox" name="white" id="white"></label>
        <label>asian<input type="checkbox" name="asian" id="asian"></label>
        <label>hispanic<input type="checkbox" name="hispanic" id="hispanic"></label>
    </div><br><br>
    Age Range:
    <div>
        <label>min<input type="text" name="min_age" id="min_age"></label>
        to
        <label>max<input type="text" name="min_age" id="max_age"></label>
    </div><br><br>

    Gender:
    <div >
        <label>male<input type="checkbox" name="male" id="male"></label>
        <label>female<input type="checkbox" name="female" id="female"></label>
        <label>non-binary<input type="checkbox" name="non_binary" id="non_binary"></label>
    </div><br><br>

    Major:
    <div>
        <label>Math<input type="checkbox" name="black" id="math"></label>
        <label>Engineering<input type="checkbox" name="black" id="engineering"></label>
        <label>Liberal Arts<input type="checkbox" name="black" id="liberal_arts"></label>
        <label>Health Science<input type="checkbox" name="black" id="health_science"></label>
    </div><br><br>

    <input type="submit" value="Submit" onclick="main()">
    <label>Response<input type="text" name="kkk" id="kkk"></label>
</body>
<script type="text/javascript">


    /*Fetch data from DB
    * returns array of User objects
    * */
    async function getData(){
        var jsonData= await fetch('/users/', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(res=>res.json())
            .then( json=> {return json;});
        console.log("Data fetched.");
        return jsonData;
    }//end getData()


    /*Displays data
    * prints: user data as: gender, age, race
    * */
    function display(data){


        for (let e=0;e<data.length; e++){
            console.log(data[e].gender,data[e].age,data[e].race);
        }


    }//end display()


    /*Collects user criterias from HTML input
    * returns: an Array of criterias
    * */
    async function selectedDemos(){
        var demos={};
        const male = document.getElementById("male");
        const female = document.getElementById("female");
        const non_binary = document.getElementById("non_binary");
        const black = document.getElementById("black");
        const white = document.getElementById("white");
        const asian = document.getElementById("asian");
        const hispanic = document.getElementById("hispanic");
        const min_age = document.getElementById("min_age");
        const max_age = document.getElementById("max_age");
        
        var genders=[];
        if (male.checked){
            genders.push("Male");
        }
        if (female.checked){
            genders.push("Female");
        }
        if (non_binary.checked) {
            genders.push("Non-Binary");
        }

        var key="genders";
        demos[key]=genders;
        console.log(demos.genders);
        var races=[];
        if (black.checked){
            races.push("Black");
        }
        if (white.checked){
            races.push("White");
        }
        if (asian.checked){
            races.push("Asian");
        }
        if (hispanic.checked){
            races.push("Hispanic");
        }
        key="races";
        demos[key] = races;

        var ageRange=[];
        if (min_age!=undefined){
            ageRange[0]=min_age;
        }
        if (max_age!=undefined){
            ageRange[1]=max_age;
        }
        key="ageRange";
        demos[key] = ageRange;

        return demos;
    }//end selectedDemos()


    /*filters data by demographic criteria
    * Arguments: array of demo criterias, array of users
    * returns: array of users that meet criterias.
    *  */
    function narrowData(demos,arrayData) {
        var filteredData=[];
        for(let e in arrayData) {

            if (demos.genders != undefined) {
                var gender= arrayData[e].gender;
                if (demos.genders.find(function(element){return element == gender;})== undefined){
                    /* TESTING TOOLS
                    console.log("working so far: 2");
                    console.log(arrayData[e].gender);
                    delete(arrayData[e]);
                    */
                    continue;

                }
            }
            if (demos.races != undefined ) {
                var race= arrayData[e].race;
                if (demos.races.find(function(element){return element == race;}) == undefined){
                    /* TESTING TOOLS
                    console.log("working so far: 2");
                    //console.log(arrayData[e].gender);
                    //delete(arrayData[e]);
                    */
                    continue;
                }
            }
            if (demos.ageRange != undefined ) {
                //console.log("working so far: 1");
                var age= arrayData[e].age;
                if (age<demos.ageRange[0] || age> demos.ageRange[1]){
                    /* TESTING TOOLS
                    console.log("working so far: 2");
                    console.log(arrayData[e].gender);
                    delete(arrayData[e]);
                    */
                    continue;
                }
            }
           filteredData.push(arrayData[e]);


        }
        return filteredData;
    }// end narrowData()

    /* main method that runs onclick()*/
    async function main() {
        var Demos=await selectedDemos();
        var fullData= await getData();


        console.log("full Data:");
        display(fullData);
        var newSet=await narrowData(Demos,fullData);
        console.log(newSet.length);
        console.log("filtered Data:");
        display(newSet);
    }

</script>
</html>